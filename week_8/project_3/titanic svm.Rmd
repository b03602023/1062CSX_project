---
title: "titanic SVM"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Read data and change its data type
```{r}
data <- read.csv("titanicTrain.csv")
# 去除NA
# 整理資料格式
data <- data[1:1000,]
sapply(data, function(x) {sum(is.na(x))})
data <- subset(data, select = -body)
data <- data[is.na(data$age)!=TRUE,]
data$fs <- as.integer(data$parch)+as.integer(data$sibsp)+1

data$boat <- as.character(data$boat)
data$survived <- as.factor(data$survived)
data$pclass <- as.factor(data$pclass)
data$sibsp <- as.factor(data$sibsp)
data$parch <- as.factor(data$parch)
data$fs <- as.factor(data$fs)
library(knitr)
kable(summary(data))

```

Use EDA to analyze the data.


## Summary:

```{r}

# EDA
library(ggplot2)
library(scales)
library(gridExtra)

ggplot(data, aes(x = survived, fill = survived)) +
  geom_bar(stat='count', position='dodge') +
  labs(x = 'How many people died and survived on the Titanic?') +
  geom_label(stat='count',aes(label=..count..), size=3) +
  theme_grey(base_size = 10)

```

## 性別與艙等影響
性別和艙等的EDA分析
發現class1和2女性活下來的比例相當高，而class2和3男性活下來的比例最低

```{r}

#------- gender/sex-----------
b1 <- ggplot(data, aes(x = pclass)) +
  geom_bar(stat='count', position='dodge') +
  geom_label(stat='count',aes(label=..count..), size=3) +
  facet_grid(.~sex) +
  theme_grey(base_size = 10)

b2 <-
  ggplot(data, aes(x = pclass, fill = survived)) +
  geom_bar(stat='count', position='dodge') +
  geom_label(stat='count',aes(label=..count..), size=3, position = position_dodge(0.9)) +
  labs(x = 'pclass', y= "count") + facet_grid(.~sex) +
  theme(legend.position="none") + theme_grey()



# -----------pclass and sex-------------
### ----------class1.2女性活下來的比例相當高，class2.3男性活下來的比例最低
b3 <-
  ggplot(data, aes(x = pclass, fill = survived)) +
  geom_bar(stat='count', position='fill') +
  labs(x = 'pclass', y= "Percent") + facet_grid(.~sex) +
  theme(legend.position="none") + theme_grey()



grid.arrange(b1,b2,nrow=1)
b3

```

## 艙等
而單就艙等來評估的話，雖然各艙等的人數並無明顯差距，1等艙的旅客存活人數佔多數，而3等艙的旅客死亡人數則佔多數，2等艙則是較無明顯區別

```{r}


#------ pclass ----------
ggplot(data, aes(x = survived, fill = pclass)) +
  geom_bar(stat='count', position='dodge') +
  geom_label(stat='count',aes(label=..count..), size=3, position=position_dodge(0.9)) +
  labs(x = 'class') +
  theme_grey(base_size = 10)

b1 <- ggplot(data, aes(x = pclass, fill = pclass)) +
  geom_bar(stat='count', position='dodge') +
  geom_label(stat='count',aes(label=..count..), size=3) +
  theme_grey(base_size = 10)

b2 <-
  ggplot(data, aes(x = pclass, fill = survived)) +
  geom_bar(stat='count', position='dodge') +
  geom_label(stat='count',aes(label=..count..), size=3, position=position_dodge(0.9)) +
  theme_grey(base_size = 10)
grid.arrange(b1,b2, nrow=1)

```

## 性別與兄弟姊妹的影響



```{r}

#-----sibsp-----------

length(data$age[data$survived==1 & data$sibsp!=0 & data$parch!=0& data$sex=="female"])/length(data$age[data$survived==1 & data$sibsp!=0 & data$parch!=0])
length(data$age[data$survived==0 & data$sibsp!=0 & data$parch!=0& data$sex=="male"])/length(data$age[data$survived==0 & data$sibsp!=0 & data$parch!=0])

# total statistics
b1 <- ggplot(data, aes(x = sibsp, fill = sibsp)) +
  geom_bar(stat='count', position='dodge') +
  geom_label(stat='count',aes(label=..count..), size=3) +
  theme_grey(base_size = 15)
# statistics showing survival with sex difference
b2 <-
  ggplot(data, aes(x = sibsp, fill = survived)) +
  geom_bar(stat='count', position='dodge') +
  geom_label(stat='count',aes(label=..count..), size=3, position=position_dodge(0.9)) +
  facet_grid(.~sex) +
  theme_grey(base_size = 15)

# total statistics with sex difference
b3 <-
  ggplot(data, aes(x = sibsp, fill = sex)) +
  geom_bar(stat='count', position = 'dodge') +
  geom_label(stat = 'count', aes(label =..count..), size = 3, 
             position=position_dodge(0.9))+
  theme_grey(base_size = 15)

# percent statistics showing survival with sex difference
b4 <- 
  ggplot(data, aes(x = sibsp, fill = survived)) +
  geom_bar(stat='count', position='fill') +
  labs(x = 'sibsp', y= "Percent") + facet_grid(.~sex) +
  theme(legend.position="none") + theme_grey()

grid.arrange(b1,b2,b3,b4, nrow=2)

```

左上圖為總旅客兄弟姊妹個數的柱狀圖分布情形
左下圖為總旅客兄弟姊妹個數以性別分類的柱狀圖分布情形
右上圖和右下圖為性別與兄弟姊妹個數和存活與否的關係，顯示男性存活比率都偏低；而女性的中若手足和配偶數量加起來不超過3，存活機率很高，幾乎都有達到80%
活下且有兄弟姊妹親人是女性的比例是


男性生存比例偏低，但若在sibsp為1和2之間的生存率有接近0.5
女性的生存率在sibsp為5以前都很高。
# 注意: parch為parch為2以前的樣本量較多。

```{r}
#----- parch-------------
b1 <- ggplot(data, aes(x = parch, fill = parch)) +
  geom_bar(stat='count', position='dodge') +
  facet_grid(.~sex) +
  geom_label(stat='count',aes(label=..count..), size=8) +
  theme_grey(base_size = 15)

b2 <-
  ggplot(data, aes(x = parch, fill = survived)) +
  geom_bar(stat='count', position='dodge') +
  geom_label(stat='count',aes(label=..count..), size=8, position=position_dodge(0.9)) +
  facet_grid(.~sex) +
  theme_grey(base_size = 15)

ggplot(data, aes(x = parch, fill = survived)) +
  geom_bar(stat='count', position='fill') +
  labs(x = 'parch', y= "Percent") + facet_grid(.~sex) +
  theme(legend.position="none") + theme_grey()


grid.arrange(b1,b2, nrow=1)


```